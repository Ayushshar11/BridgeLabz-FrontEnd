<!doctype html>
<html>
<head><meta charset="utf-8"><title>Q2 - Employee Status (XHR & PATCH)</title></head>
<body>
  <h2>Employees</h2>
  <div id="employees"></div>
  <div id="msg" style="color:red"></div>
<script>
function loadEmployees(){
  var xhr = new XMLHttpRequest();
  xhr.open('GET','http://localhost:3002/employees');
  xhr.onload = function(){
    if(xhr.status===200){
      var list = JSON.parse(xhr.responseText);
      var html = '';
      list.forEach(e => {
        html += `<div data-id="${e.id}">${e.name} - <span class="status">${e.status}</span> <button onclick="toggle(${e.id})">Toggle</button></div>`;
      });
      document.getElementById('employees').innerHTML = html;
    } else { document.getElementById('msg').textContent='Failed to load employees'; }
  };
  xhr.send();
}

function toggle(id){
  var row = document.querySelector('[data-id="'+id+'"]');
  var statusSpan = row.querySelector('.status');
  var old = statusSpan.textContent;
  var newStatus = old==='active' ? 'inactive' : 'active';
  statusSpan.textContent = newStatus; // optimistic
  var xhr = new XMLHttpRequest();
  xhr.open('PATCH','http://localhost:3002/employees/'+id);
  xhr.setRequestHeader('Content-Type','application/json;charset=UTF-8');
  xhr.onload = function(){
    if(xhr.status>=200 && xhr.status<300){
      // ok
    } else {
      statusSpan.textContent = old; // revert
      document.getElementById('msg').textContent='Update failed, try again';
    }
  };
  xhr.onerror = function(){ statusSpan.textContent = old; document.getElementById('msg').textContent='Network error'; };
  xhr.send(JSON.stringify({status:newStatus}));
}

loadEmployees();
</script>
</body>
</html>
